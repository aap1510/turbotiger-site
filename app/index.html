<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Download Turbo Tiger</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#fafafa;color:#111;}
  .wrap{max-width:720px;margin:48px auto;padding:18px;}
  .card{background:#fff;padding:18px;border-radius:12px;box-shadow:0 12px 26px rgba(0,0,0,0.06);}
  .btn{display:inline-block;padding:12px 16px;border-radius:10px;text-decoration:none;font-weight:700;cursor:pointer}
  .btn-primary{background:#f4b400;color:#111;}
  .btn-ghost{background:transparent;border:1px solid #ddd;color:#111}
  .muted{color:#666;font-size:14px}
  .small{font-size:13px;color:#666}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h2>Preparando o download</h2>
    <p class="muted" id="status">Detectando seu dispositivo e preparando o download...</p>

    <div style="margin-top:14px;">
      <a id="manualLink" class="btn btn-primary" href="#">Baixar (se não baixar automaticamente)</a>
      <a id="openApp" class="btn btn-ghost" style="margin-left:8px" href="#">Abrir Turbo Tiger</a>
    </div>

    <p class="small" style="margin-top:12px">Se você instalou o app, clique em <strong>Abrir Turbo Tiger</strong> para que o app receba seu código de indicação automaticamente.</p>
    <p class="small" id="debug" style="margin-top:12px;color:#444"></p>
  </div>
</div>

<script>
// === CONFIG - altere estes valores para seus URLs reais ANTES de publicar ===
// Se você hospedar os APKs na pasta /downloads/ do GitHub Pages, mantenha caminhos relativos.
// Ou cole o link do GitHub Releases / S3 / Render. 
const APK32 = '/downloads/TurboTiger-32.apk'; // substitua pela URL real do APK 32-bit
const APK64 = '/downloads/TurboTiger-64.apk'; // substitua pela URL real do APK 64-bit
const LOG_ENDPOINT = '/download'; // substitua pelo seu endpoint de registro (ex: https://turbotiger-download.onrender.com/download)
// ============================================================================

function getQueryParam(name){ const p=new URLSearchParams(location.search); return p.get(name); }
function isAndroid(){ return /android/i.test(navigator.userAgent); }
function detect64(){ const ua = navigator.userAgent.toLowerCase(); if(ua.includes('arm64')||ua.includes('aarch64')||ua.includes('x86_64')||ua.includes('amd64')) return true; return false; }

const indicator = getQueryParam('indicador') || localStorage.getItem('turbo_indicator') || '';
if (indicator) localStorage.setItem('turbo_indicator', indicator);

const status = document.getElementById('status');
const manualLink = document.getElementById('manualLink');
const openApp = document.getElementById('openApp');
const debug = document.getElementById('debug');

debug.textContent = 'Indicador: ' + indicator + ' | UA: ' + navigator.userAgent;

// Registra indicador no servidor (non-blocking). Ajuste LOG_ENDPOINT para seu serviço.
if (indicator && LOG_ENDPOINT) {
  try {
    fetch(LOG_ENDPOINT + '?indicador=' + encodeURIComponent(indicator), { method:'GET', mode:'no-cors' })
      .catch(()=>{/* sem-ação em caso de erro */});
  } catch(e){}
}

if (!isAndroid()) {
  status.textContent = 'Este download é destinado a dispositivos Android. Se estiver no Android, aguarde o redirecionamento ou clique em Baixar.';
  manualLink.href = APK32;
} else {
  const is64 = detect64();
  const target = is64 ? APK64 : APK32;
  status.textContent = 'Detectado ' + (is64 ? '64-bit' : '32-bit') + ' — redirecionando para o download...';
  manualLink.href = target + (indicator ? ('?indicador=' + encodeURIComponent(indicator)) : '');
  // redireciona automaticamente após pequeno atraso para permitir registro
  setTimeout(()=>{ window.location.href = manualLink.href; }, 1200);
}

// deep link para abrir o app após instalação
openApp.href = 'turbotiger://install?indicador=' + encodeURIComponent(indicator || '');
openApp.addEventListener('click', function(){ setTimeout(()=>{ status.textContent = 'Se o app não abrir, verifique se foi instalado e clique novamente.'; }, 600); });
</script>
</body>
</html>